"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createOrUpdateProduct = void 0;
// Dependencies
const date_fns_1 = require("date-fns");
const date_fns_tz_1 = require("date-fns-tz");
const getReleaseDate = () => {
    const timeZone = 'America/Sao_Paulo';
    const zonedDate = date_fns_tz_1.utcToZonedTime(new Date(), timeZone);
    return date_fns_1.formatISO(zonedDate);
};
async function createOrUpdateProduct(ctx) {
    const { partner, account } = ctx.state;
    const product = await ctx.clients.catalog.getProductByRefId(account);
    const productData = {
        Name: partner.name,
        LinkId: partner.name.toLowerCase().replace(/[\s]+/g, '-'),
        RefId: partner.account,
        Description: partner.description,
        DescriptionShort: partner.description,
        KeyWords: partner.name.toLowerCase(),
        Title: partner.name,
        MetaTagDescription: partner.name,
        TaxCode: '',
        BrandId: 2000000,
        DepartmentId: 1,
        CategoryId: 1,
        Score: 1,
        SupplierId: 1,
        AdWordsRemarketingCode: null,
        LomadeeCampaignCode: null,
        ShowWithoutStock: true,
        IsActive: true,
        IsVisible: true,
        ReleaseDate: getReleaseDate(),
    };
    if (product && product.Id) {
        ctx.state.product = await ctx.clients.catalog.updateProductById(Number(product.Id), productData);
    }
    else {
        ctx.state.product = await ctx.clients.catalog.createProduct(productData);
        await ctx.clients.catalog.createProductToTradePolicy(ctx.state.product.Id);
    }
}
exports.createOrUpdateProduct = createOrUpdateProduct;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbm9kZS9taWRkbGV3YXJlcy9jcmVhdGVPclVwZGF0ZVByb2R1Y3QvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsZUFBZTtBQUNmLHVDQUFvQztBQUNwQyw2Q0FBNEM7QUFFNUMsTUFBTSxjQUFjLEdBQUcsR0FBRyxFQUFFO0lBQzFCLE1BQU0sUUFBUSxHQUFHLG1CQUFtQixDQUFBO0lBQ3BDLE1BQU0sU0FBUyxHQUFHLDRCQUFjLENBQUMsSUFBSSxJQUFJLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUV0RCxPQUFPLG9CQUFTLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDN0IsQ0FBQyxDQUFBO0FBRU0sS0FBSyxVQUFVLHFCQUFxQixDQUFDLEdBQXVCO0lBQ2pFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtJQUN0QyxNQUFNLE9BQU8sR0FBRyxNQUFNLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBRXBFLE1BQU0sV0FBVyxHQUFHO1FBQ2xCLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSTtRQUNsQixNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQztRQUN6RCxLQUFLLEVBQUUsT0FBTyxDQUFDLE9BQU87UUFDdEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1FBQ2hDLGdCQUFnQixFQUFFLE9BQU8sQ0FBQyxXQUFXO1FBQ3JDLFFBQVEsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtRQUNwQyxLQUFLLEVBQUUsT0FBTyxDQUFDLElBQUk7UUFDbkIsa0JBQWtCLEVBQUUsT0FBTyxDQUFDLElBQUk7UUFDaEMsT0FBTyxFQUFFLEVBQUU7UUFDWCxPQUFPLEVBQUUsT0FBTztRQUNoQixZQUFZLEVBQUUsQ0FBQztRQUNmLFVBQVUsRUFBRSxDQUFDO1FBQ2IsS0FBSyxFQUFFLENBQUM7UUFDUixVQUFVLEVBQUUsQ0FBQztRQUNiLHNCQUFzQixFQUFFLElBQUk7UUFDNUIsbUJBQW1CLEVBQUUsSUFBSTtRQUN6QixnQkFBZ0IsRUFBRSxJQUFJO1FBQ3RCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsU0FBUyxFQUFFLElBQUk7UUFDZixXQUFXLEVBQUUsY0FBYyxFQUFFO0tBQzlCLENBQUE7SUFFRCxJQUFJLE9BQU8sSUFBSSxPQUFPLENBQUMsRUFBRSxFQUFFO1FBQ3pCLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQzdELE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQ2xCLFdBQVcsQ0FDWixDQUFBO0tBQ0Y7U0FBTTtRQUNMLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBRXhFLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsMEJBQTBCLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUE7S0FDM0U7QUFDSCxDQUFDO0FBckNELHNEQXFDQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIERlcGVuZGVuY2llc1xuaW1wb3J0IHsgZm9ybWF0SVNPIH0gZnJvbSAnZGF0ZS1mbnMnXG5pbXBvcnQgeyB1dGNUb1pvbmVkVGltZSB9IGZyb20gJ2RhdGUtZm5zLXR6J1xuXG5jb25zdCBnZXRSZWxlYXNlRGF0ZSA9ICgpID0+IHtcbiAgY29uc3QgdGltZVpvbmUgPSAnQW1lcmljYS9TYW9fUGF1bG8nXG4gIGNvbnN0IHpvbmVkRGF0ZSA9IHV0Y1RvWm9uZWRUaW1lKG5ldyBEYXRlKCksIHRpbWVab25lKVxuXG4gIHJldHVybiBmb3JtYXRJU08oem9uZWREYXRlKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlT3JVcGRhdGVQcm9kdWN0KGN0eDogQ3VzdG9tRXZlbnRDb250ZXh0KSB7XG4gIGNvbnN0IHsgcGFydG5lciwgYWNjb3VudCB9ID0gY3R4LnN0YXRlXG4gIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBjdHguY2xpZW50cy5jYXRhbG9nLmdldFByb2R1Y3RCeVJlZklkKGFjY291bnQpXG5cbiAgY29uc3QgcHJvZHVjdERhdGEgPSB7XG4gICAgTmFtZTogcGFydG5lci5uYW1lLFxuICAgIExpbmtJZDogcGFydG5lci5uYW1lLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW1xcc10rL2csICctJyksXG4gICAgUmVmSWQ6IHBhcnRuZXIuYWNjb3VudCxcbiAgICBEZXNjcmlwdGlvbjogcGFydG5lci5kZXNjcmlwdGlvbixcbiAgICBEZXNjcmlwdGlvblNob3J0OiBwYXJ0bmVyLmRlc2NyaXB0aW9uLFxuICAgIEtleVdvcmRzOiBwYXJ0bmVyLm5hbWUudG9Mb3dlckNhc2UoKSxcbiAgICBUaXRsZTogcGFydG5lci5uYW1lLFxuICAgIE1ldGFUYWdEZXNjcmlwdGlvbjogcGFydG5lci5uYW1lLFxuICAgIFRheENvZGU6ICcnLFxuICAgIEJyYW5kSWQ6IDIwMDAwMDAsXG4gICAgRGVwYXJ0bWVudElkOiAxLFxuICAgIENhdGVnb3J5SWQ6IDEsXG4gICAgU2NvcmU6IDEsXG4gICAgU3VwcGxpZXJJZDogMSxcbiAgICBBZFdvcmRzUmVtYXJrZXRpbmdDb2RlOiBudWxsLFxuICAgIExvbWFkZWVDYW1wYWlnbkNvZGU6IG51bGwsXG4gICAgU2hvd1dpdGhvdXRTdG9jazogdHJ1ZSxcbiAgICBJc0FjdGl2ZTogdHJ1ZSxcbiAgICBJc1Zpc2libGU6IHRydWUsXG4gICAgUmVsZWFzZURhdGU6IGdldFJlbGVhc2VEYXRlKCksXG4gIH1cblxuICBpZiAocHJvZHVjdCAmJiBwcm9kdWN0LklkKSB7XG4gICAgY3R4LnN0YXRlLnByb2R1Y3QgPSBhd2FpdCBjdHguY2xpZW50cy5jYXRhbG9nLnVwZGF0ZVByb2R1Y3RCeUlkKFxuICAgICAgTnVtYmVyKHByb2R1Y3QuSWQpLFxuICAgICAgcHJvZHVjdERhdGFcbiAgICApXG4gIH0gZWxzZSB7XG4gICAgY3R4LnN0YXRlLnByb2R1Y3QgPSBhd2FpdCBjdHguY2xpZW50cy5jYXRhbG9nLmNyZWF0ZVByb2R1Y3QocHJvZHVjdERhdGEpXG5cbiAgICBhd2FpdCBjdHguY2xpZW50cy5jYXRhbG9nLmNyZWF0ZVByb2R1Y3RUb1RyYWRlUG9saWN5KGN0eC5zdGF0ZS5wcm9kdWN0LklkKVxuICB9XG59XG4iXX0=