"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.saveServices = void 0;
// Dependencies
const lodash_1 = require("lodash");
const getAllServices = (partnerID, ctx) => {
    return ctx.clients.masterdata.searchDocuments({
        dataEntity: 'PS',
        fields: ['id', 'name', 'partnerID', 'isActive', 'isRemoved', 'description'],
        where: `(partnerID=${partnerID} AND isRemoved=false)`,
        pagination: {
            page: 1,
            pageSize: 5,
        },
    });
};
exports.saveServices = async (_, { partnerID, services }, ctx) => {
    await ctx.clients.masterdata.updatePartialDocument({
        id: partnerID,
        dataEntity: 'PN',
        fields: {
            status: 'PENDING',
        },
    });
    const promises = services.map((service) => {
        return ctx.clients.masterdata.updatePartialDocument({
            id: service.id,
            dataEntity: 'PS',
            fields: lodash_1.omit(service, 'id'),
        });
    });
    await Promise.all(promises);
    return getAllServices(partnerID, ctx);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvbm9kZS9yZXNvbHZlcnMvc2F2ZVNlcnZpY2VzL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGVBQWU7QUFDZixtQ0FBNkI7QUFXN0IsTUFBTSxjQUFjLEdBQUcsQ0FBQyxTQUF5QixFQUFFLEdBQVksRUFBRSxFQUFFO0lBQ2pFLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFXO1FBQ3RELFVBQVUsRUFBRSxJQUFJO1FBQ2hCLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsYUFBYSxDQUFDO1FBQzNFLEtBQUssRUFBRSxjQUFjLFNBQVMsdUJBQXVCO1FBQ3JELFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxDQUFDO1lBQ1AsUUFBUSxFQUFFLENBQUM7U0FDWjtLQUNGLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQTtBQUVZLFFBQUEsWUFBWSxHQUFHLEtBQUssRUFDL0IsQ0FBTSxFQUNOLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBUSxFQUM3QixHQUFZLEVBQ1osRUFBRTtJQUNGLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUM7UUFDakQsRUFBRSxFQUFFLFNBQVM7UUFDYixVQUFVLEVBQUUsSUFBSTtRQUNoQixNQUFNLEVBQUU7WUFDTixNQUFNLEVBQUUsU0FBUztTQUNsQjtLQUNGLENBQUMsQ0FBQTtJQUVGLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtRQUN4QyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLHFCQUFxQixDQUFDO1lBQ2xELEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRTtZQUNkLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLE1BQU0sRUFBRSxhQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQztTQUM1QixDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtJQUVGLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUUzQixPQUFPLGNBQWMsQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUE7QUFDdkMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRGVwZW5kZW5jaWVzXG5pbXBvcnQgeyBvbWl0IH0gZnJvbSAnbG9kYXNoJ1xuXG4vLyBUeXBpbmdcbmltcG9ydCB7IElQYXJ0bmVyIH0gZnJvbSAnLi4vLi4vdHlwaW5ncy9wYXJ0bmVyJ1xuaW1wb3J0IHsgSVNlcnZpY2UgfSBmcm9tICcuLi8uLi90eXBpbmdzL3NlcnZpY2UnXG5cbmludGVyZmFjZSBBcmdzIHtcbiAgcGFydG5lcklEOiBJUGFydG5lclsnaWQnXVxuICBzZXJ2aWNlczogSVNlcnZpY2VbXVxufVxuXG5jb25zdCBnZXRBbGxTZXJ2aWNlcyA9IChwYXJ0bmVySUQ6IElQYXJ0bmVyWydpZCddLCBjdHg6IENvbnRleHQpID0+IHtcbiAgcmV0dXJuIGN0eC5jbGllbnRzLm1hc3RlcmRhdGEuc2VhcmNoRG9jdW1lbnRzPElTZXJ2aWNlPih7XG4gICAgZGF0YUVudGl0eTogJ1BTJyxcbiAgICBmaWVsZHM6IFsnaWQnLCAnbmFtZScsICdwYXJ0bmVySUQnLCAnaXNBY3RpdmUnLCAnaXNSZW1vdmVkJywgJ2Rlc2NyaXB0aW9uJ10sXG4gICAgd2hlcmU6IGAocGFydG5lcklEPSR7cGFydG5lcklEfSBBTkQgaXNSZW1vdmVkPWZhbHNlKWAsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgcGFnZTogMSxcbiAgICAgIHBhZ2VTaXplOiA1LFxuICAgIH0sXG4gIH0pXG59XG5cbmV4cG9ydCBjb25zdCBzYXZlU2VydmljZXMgPSBhc3luYyAoXG4gIF86IGFueSxcbiAgeyBwYXJ0bmVySUQsIHNlcnZpY2VzIH06IEFyZ3MsXG4gIGN0eDogQ29udGV4dFxuKSA9PiB7XG4gIGF3YWl0IGN0eC5jbGllbnRzLm1hc3RlcmRhdGEudXBkYXRlUGFydGlhbERvY3VtZW50KHtcbiAgICBpZDogcGFydG5lcklELFxuICAgIGRhdGFFbnRpdHk6ICdQTicsXG4gICAgZmllbGRzOiB7XG4gICAgICBzdGF0dXM6ICdQRU5ESU5HJyxcbiAgICB9LFxuICB9KVxuXG4gIGNvbnN0IHByb21pc2VzID0gc2VydmljZXMubWFwKChzZXJ2aWNlKSA9PiB7XG4gICAgcmV0dXJuIGN0eC5jbGllbnRzLm1hc3RlcmRhdGEudXBkYXRlUGFydGlhbERvY3VtZW50KHtcbiAgICAgIGlkOiBzZXJ2aWNlLmlkLFxuICAgICAgZGF0YUVudGl0eTogJ1BTJyxcbiAgICAgIGZpZWxkczogb21pdChzZXJ2aWNlLCAnaWQnKSxcbiAgICB9KVxuICB9KVxuXG4gIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKVxuXG4gIHJldHVybiBnZXRBbGxTZXJ2aWNlcyhwYXJ0bmVySUQsIGN0eClcbn1cbiJdfQ==